<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Before you start - Supercomputing for Big Data - Lab Manual</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction/index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../introduction/goal-of-this-lab.html"><strong aria-hidden="true">1.1.</strong> Goal of this lab</a></li><li class="chapter-item expanded "><a href="../introduction/communication-with-tas.html"><strong aria-hidden="true">1.2.</strong> Communication with TAs</a></li><li class="chapter-item expanded "><a href="../introduction/code-repositories.html"><strong aria-hidden="true">1.3.</strong> Code repositories</a></li><li class="chapter-item expanded "><a href="../introduction/groups.html"><strong aria-hidden="true">1.4.</strong> Groups</a></li><li class="chapter-item expanded "><a href="../introduction/aws.html"><strong aria-hidden="true">1.5.</strong> AWS</a></li><li class="chapter-item expanded "><a href="../introduction/grading.html"><strong aria-hidden="true">1.6.</strong> Grading</a></li></ol></li><li class="chapter-item expanded "><a href="../getting-started/index.html"><strong aria-hidden="true">2.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting-started/docker.html"><strong aria-hidden="true">2.1.</strong> Docker</a></li><li class="chapter-item expanded "><a href="../getting-started/scala.html"><strong aria-hidden="true">2.2.</strong> Scala</a></li><li class="chapter-item expanded "><a href="../getting-started/apache-spark/index.html"><strong aria-hidden="true">2.3.</strong> Apache Spark</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting-started/apache-spark/resilient-distributed-datasets.html"><strong aria-hidden="true">2.3.1.</strong> Resilient Distributed Datasets</a></li><li class="chapter-item expanded "><a href="../getting-started/apache-spark/dataframe-and-dataset.html"><strong aria-hidden="true">2.3.2.</strong> Dataframe and Dataset</a></li><li class="chapter-item expanded "><a href="../getting-started/apache-spark/packaging-your-application-using-sbt.html"><strong aria-hidden="true">2.3.3.</strong> Packaging your application using SBT</a></li></ol></li><li class="chapter-item expanded "><a href="../getting-started/amazon-web-services.html"><strong aria-hidden="true">2.4.</strong> Amazon Web Services</a></li><li class="chapter-item expanded "><a href="../getting-started/apache-kafka.html"><strong aria-hidden="true">2.5.</strong> Apache Kafka</a></li><li class="chapter-item expanded "><a href="../getting-started/openstreetmap.html"><strong aria-hidden="true">2.6.</strong> OpenStreetMap</a></li></ol></li><li class="chapter-item expanded "><a href="../lab1/index.html"><strong aria-hidden="true">3.</strong> Lab 1</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../lab1/before-you-start.html"><strong aria-hidden="true">3.1.</strong> Before you start</a></li><li class="chapter-item expanded "><a href="../lab1/assignment.html"><strong aria-hidden="true">3.2.</strong> Assignment</a></li><li class="chapter-item expanded "><a href="../lab1/deliverables.html"><strong aria-hidden="true">3.3.</strong> Deliverables</a></li><li class="chapter-item expanded "><a href="../lab1/rubric.html"><strong aria-hidden="true">3.4.</strong> Rubric</a></li></ol></li><li class="chapter-item expanded "><a href="../lab2/index.html"><strong aria-hidden="true">4.</strong> Lab 2</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../lab2/before-you-start.html" class="active"><strong aria-hidden="true">4.1.</strong> Before you start</a></li><li class="chapter-item expanded "><a href="../lab2/assignment.html"><strong aria-hidden="true">4.2.</strong> Assignment</a></li><li class="chapter-item expanded "><a href="../lab2/deliverables.html"><strong aria-hidden="true">4.3.</strong> Deliverables</a></li><li class="chapter-item expanded "><a href="../lab2/rubric.html"><strong aria-hidden="true">4.4.</strong> Rubric</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../faq.html">FAQ</a></li><li class="chapter-item expanded affix "><a href="../links.html">Useful links</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Supercomputing for Big Data - Lab Manual</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2><a class="header" href="#before-you-start" id="before-you-start">Before you start</a></h2>
<p>To make sure this assignment is challenging and instructive for all students, we
require all Spark applications to have a level 3 robustness implementation. Please
use the guide below to upgrade your application if needed.</p>
<p><strong>We assume everybody has access to AWS credits via both the GitHub developer
pack and the AWS classroom in their lab group! If this is not the case, please
ask for help, or send us an email.</strong></p>
<p><strong>You pay for cluster per commissioned minute. After you are done working with a
cluster, please terminate the cluster, to avoid unnecessary costs.</strong></p>
<p>Make sure you have read the introduction on Amazon Web services in the guide
chapter before starting the assignment.</p>
<h3><a class="header" href="#level-3-robustness-guide" id="level-3-robustness-guide">Level 3 robustness guide</a></h3>
<p>The description here describes how you can upgrade your application to a level 3 robustness implementation (as listed in the rubric of lab 1).</p>
<p>Please be aware that:</p>
<ul>
<li>If the method in your application from lab 1 is the same as the one described below, but implemented differently, you are <strong>not required</strong> to modify it.</li>
<li>If the method in your application from lab 1 is more robust than the one described below, you are <strong>allowed to modify your application to be less robust</strong> if you have scalability or performance issues.</li>
</ul>
<p>This guide uses relations to construct polygons for city boundaries and then performs <a href="https://en.wikipedia.org/wiki/Point_in_polygon">point-in-polygon</a> tests to check if a brewery is within a certain city.</p>
<ol>
<li>Read input data set and split into:</li>
</ol>
<ul>
<li><a href="https://wiki.openstreetmap.org/wiki/Node"><code>nodes</code></a></li>
<li><a href="https://wiki.openstreetmap.org/wiki/Way"><code>ways</code></a></li>
<li><a href="https://wiki.openstreetmap.org/wiki/Relation"><code>relations</code></a></li>
</ul>
<p>Make sure you understand the difference between these types and how to dereference IDs in both ways and relations:</p>
<ul>
<li>Ways reference nodes in the <code>nds</code> field. Typically you <a href="https://spark.apache.org/docs/2.4.6/api/scala/index.html#org.apache.spark.sql.functions$@posexplode(e:org.apache.spark.sql.Column):org.apache.spark.sql.Column"><code>posexplode</code></a> the field with references and then <code>join</code> with the <code>nodes</code> on ID. Use <code>posexplode</code> instead of <code>explode</code> because nodes in a way are ordered, and this method allows you to recover that information.</li>
</ul>
<p>Below is an incomplete example that shows how you could dereference nodes for ways using the Dataframe API. This may look a bit different if you are using the Dataset API.</p>
<pre><code class="language-scala">val nodes = df
      .filter('type === &quot;node&quot;)
      .select(
        'id.as(&quot;node_id&quot;),
        ...
      )

val ways = df
      .filter('type === &quot;way&quot;)
      .select(
        'id.as(&quot;way_id&quot;),
        ...,
        posexplode($&quot;nds.ref&quot;)
      )
      .select(
        'way_id,
        ...,
        struct('pos, 'col.as(&quot;id&quot;)).as(&quot;node&quot;)
      )
      .join(nodes, $&quot;node.id&quot; === 'node_id)
      .groupBy('way_id)
      .agg(
        array_sort(
          collect_list(
            struct($&quot;node.pos&quot;.as(&quot;pos&quot;), ...)
          )
        ).as(&quot;way&quot;)
      )
</code></pre>
<ul>
<li>Relations reference nodes and ways in the <code>members.ref</code> field. You can <code>posexplode</code> the members field and join with <code>ways</code> and <code>nodes</code>. You need to <code>posexplode</code> and <code>join</code> the <code>ways</code> again to dereference the nodes that belong to that way. Make sure you understand the data in the <code>members.role</code> and <code>members.type</code> fields.</li>
</ul>
<p>To collect the exploded and joined information in single rows you can <code>groupBy</code> and <code>agg</code> with <code>collect_list</code>. For ways you <code>groupBy</code> the ID of the way and collect the list of nodes (maintain the order). For relations you first <code>groupBy</code> relation ID and way ID to collect the list of nodes belonging to the ways. Then you can <code>groupBy</code> relation ID to collect the ways in the relation.</p>
<ol start="2">
<li>Find breweries</li>
</ol>
<p>Use tag information from the <a href="https://wiki.openstreetmap.org/wiki/Brewery">Brewery wiki</a> to find coordinates of breweries. Nodes have coordinate information, however ways and relations require dereferencing IDs to get the nodes that make up the way or relation. For breweries you can select any node (coordinate) or average of the coordinates of the nodes that make up the way or relation. This is based on the assumption that breweries (ways and relations) don't cross city boundaries. A more robust implementation would be to recover the geometry and perform contains checks later, but this is not a requirement.</p>
<ol start="3">
<li>Find cities</li>
</ol>
<p>Use <a href="https://wiki.openstreetmap.org/wiki/Relation:boundary">boundary relations</a> to construct polygons for city boundaries. The use of third-party libraries for geometry types is encouraged. We recommend <a href="https://github.com/locationtech/jts">JTS</a>. You can use <a href="https://www.geomesa.org/">GeoMesa</a> <a href="https://www.geomesa.org/documentation/stable/user/spark/spark_jts.html">Spark JTS</a> for serialization support of geometry types. Hint take a look at the <a href="https://locationtech.github.io/jts/javadoc/org/locationtech/jts/operation/polygonize/Polygonizer.html"><code>Polygonizer</code></a> class.
You can also use other libraries e.g. <a href="https://github.com/apache/incubator-sedona">Apache Sedona</a>.</p>
<ol start="4">
<li>Check if a brewery is within the boundary of a city</li>
</ol>
<p>Perform the point-in-polygon check for breweries and cities. Use of the implementation provided your third-party library is strongly recommended.</p>
<p>If you get stuck please contact one of the TAs.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../lab2/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../lab2/assignment.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../lab2/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../lab2/assignment.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
